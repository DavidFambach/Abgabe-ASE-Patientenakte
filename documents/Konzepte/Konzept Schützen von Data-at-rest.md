# Konzept: Schützen von Data-at-rest
Der Schutz der Vertraulichkeit der über die Plattform geteilten Daten ist von besonderer Bedeutung.  Zunächst muss für jede Kommunikation zwischen den Anwendungskomponenten sowie für jede Kommunikation zwischen einem Benutzer und der Anwendung eine Vertraulichkeit und Integrität erzielt werden. Vertraulichkeit bedeutet, dass die von Benutzern übertragenen Dateien und Befehle sowie vom Webserver zurückgegebene Dateilisten und Dateien nicht gegenüber an der Kommunikation nicht beteiligten Dritten offengelegt werden. Integrität bedeutet, dass die oben benannten Daten gegen die Manipulation durch einen solchen Dritten zu schützen sind. Zu unterscheiden sind hier schwache Integrität und starke Integrität. Erstere fordert, dass eine unbefugte Manipulation nicht in einer Weise möglich ist, dass sie den Zugriffsberechtigen nicht jederzeit auffällt. Zweitere fordert, dass eine unbefugte Manipulation nicht möglich ist. Für Kommunikationsverbindungen im Internet ist existieren im Allgemeinen allerdings stets solche Dritte, die in der Lage sind, die Kommunikation vollständig zu unterbrechen und so die starke Integrität zu verletzen. Inhärent ist es also für eine Kommunikation durchs Internet im Allgemeinen nicht möglich, starke Integrität wirksam zu erzielen. Daher wird für Kommunikationsverbindungen durchs Internet für diese Anwendung nur schwache Integrität gefordert, weil damit zumindest für ungestört übertragene Daten eine Manipulationsfreiheit verifizierbar ist. Um auf Kommunikationsverbindungen die Vertraulichkeit und schwache Integrität zu sichern, wird für alle Verbindungen TLS eingesetzt.
Nicht alle Teile der Kommunikation erfordern notwendigerweise Vertraulichkeit und schwache Integrität. Beispielsweise ist für die Übertragung HTML-, CSS- und JavaScript-Ressourcen der Webseite, die den allgemeinen Seitenaufbau vorgeben und explizit keinen darzustellenden Nutzinhalt umfassen, keine Vertraulichkeit der Übertragung nötig. Das ist offensichtlich, weil diese Ressourcen öffentlich für jeden zugreifbar abgelegt werden. Es ist aber zu beachten, dass in diesem Fall aber ein Integritätsschutz unabdingbar ist. Weil die Kosten des TLS-Einsatzes für den Webseitenbetrieb vernachlässigbar sind, wird das Verfahren grundsätzlich für alle Verbindungen eingesetzt. Webclients wird auf diese Weise außerdem ermöglicht, eine Authentizitätsprüfung für den Webserver durchzuführen, indem das entsprechende Serverzertifikat überprüft wird. Dieselbe Technik wird bei der Kommunikation zwischen den einzelnen Anwendungskomponenten untereinander eingesetzt.
Sobald die von Benutzern geteilten Daten in der Datenbank abgelegt wurden, können auch Maßnahmen zum Erzielen einer starken Integrität getroffen werden. Dafür werden Benutzersitzungen authentifiziert und Autorisierungsprüfungen durchgeführt, bevor Befehle ausgeführt werden, die die zu schützenden Daten betreffen. Durch konsequentes Ablehnen nicht zulässiger Operationen wird für den Datenbankinhalt starke Integrität gegen Angriffe durch Dritte erzielt. Für privilegierte Benutzer, wie unten beschrieben, gilt dies offensichtlich nicht.
Bisher nicht berücksichtigt wurde der Schutz der Vertraulichkeit von Benutzerdaten gegen die unbefugte Einsichtnahme durch privilegierte Benutzer, die zur Konfiguration und Wartung der Anwendung weitreichende Zugriffsmöglichkeiten auf verschiedene Systeme der Anwendung besitzen. Dazu zählen insbesondere der Zugriff auf die rohen Datenbankinhalte sowie der Zugriff auf private kryptographische Schlüssel, die von der TLS-Servern für einen Identitätsnachweis eingesetzt werden. Erstere Zugriffsmöglichkeit ist bereits hinreichend, um beliebige von Benutzern abgelegte Dateien einsehen zu können, sofern keine weiteren Schutzmechanismen dies verhindern.
Problematisch ist in diesem Fall, dass aufgrund der weitreichenden Kontrolle über die relevanten Systeme kryptografische Verfahren nur dann vor dieser Benutzergruppe schützen, wenn diese Verfahren zum Schutz der Daten für den gesamten Zeitraum, in dem sich die Daten auf einem zentralen System der Anwendung befinden, dauerhaft eingesetzt werden und die zum Einsehen der Daten erforderlichen kryptografische Schlüssel auf diesen Systemen nicht zur Verfügung stehen.
Eine solche Absicherung kann nur realisiert werden, indem die Daten vor dem Hochladen durch die Webanwendung verschlüsselt werden und erst zur Einsicht nach dem Herunterladen wieder entschlüsselt werden. Es ist also neben der oben beschriebenen Verschlüsselung durch TLS eine weitere Verschlüsselung der Nutzdaten erforderlich. Der dafür verwendete Schlüssel darf auf den zentralen Systemen der Anwendung nicht zugänglich werden. Gleichzeitig ist es aber für die Freigabe von Dateien für den Zugriff durch andere Nutzer notwendig, dass diesen Benutzern der Schlüssel zur Verfügung steht. Das lässt sich realisieren, indem jedem Benutzer ein asymmetrischer Schlüssel zugeordnet wird. Die öffentlichen Komponenten dieser Schlüssel können über die Anwendung zentral bekanntgemacht werden. Zur Verschlüsselung der Dateien wird dann ein pro Datei gewählter symmetrischer Schlüssel verwendet. Dieser Schlüssel wird bei Änderungen an der Datei oder wenn Freigaben entzogen werden, neu kryptografisch sicher zufällig gewählt. Dieser Schlüssel kann dann jeweils mit den öffentlichen Schlüsseln aller Benutzer, die einen Zugriff auf die Datei erhalten sollen, verschlüsselt. Diese verschlüsselten symmetrischen Schlüssel können ebenso über die Anwendung zentral bereitgestellt werden. Privilegierte Benutzer können dann zwar auf die öffentlichen Schlüssel der Benutzer sowie auf die verschlüsselten symmetrischen Schlüssel zugreifen, aber für deren Entschlüsselung ist der private Schlüssel eines Benutzers, für den die Datei freigegeben ist, nötig.
Problematisch an diesem Ansatz ist, dass Benutzern für dieses Verfahren ein Schlüssel zu einem asymmetrischen kryptografischen Verfahren zugeordnet werden muss. Dieser darf nur dem Benutzer bekannt sein und er darf insbesondere keinem zentralen System der Anwendung bekannt werden. Folglich muss eine externe, also nicht aus der Anwendung stammende, Information als Teil dieses Schlüssels verwendet werden, weil ansonsten über die zentralen Systeme der Anwendung eine Rekonstruktion des Schlüssels möglich wäre. Zu diesem Zweck bieten sich Informationen aus dem Authentisierungsprozess an. Je nach Authentisierungsmethode stehen unterschiedliche Informationen zur Verfügung.
Im Fall einer einfachen Benutzername-Passwort-Authentifizierung kann das Passwort als externe Information gesehen werden. Üblicherweise würde für diese Authentisierungsmethode das Passwort an den Server gesendet, um die Identität nachzuweisen. Damit das Passwort aber nicht auf den zentralen Systemen verfügbar wird, darf es nicht direkt an den Webserver versendet werden. Stattdessen können aus dem Passwort zwei separate Geheimnisse berechnet werden, von denen eins als Ersatz für das Passwort der Authentisierung gegenüber der Anwendung dient. Das zweite Geheimnis kann dann als symmetrischer Schlüssel für eine vom Server bereitgestellte, verschlüsselte Datei verwendet werden, die den zu schützenden privaten Schlüssel des Benutzers enthält. Auf diese Weise muss der Benutzer lediglich, wie bei der Benutzername-Passwort-Authentifizierung üblich, ein Passwort eingeben, besitzt aber dennoch einen asymmetrischen privaten Schlüssel, der durch die zentrale Anwendung verwaltet wird, aber nicht eingesehen werden kann.
Im Fall eines externen IDP ist eine Unterstützung durch den IDP für das Verfahren erforderlich, weil für ein solches Verfahren nicht notwendigerweise ein Geheimnis liefert, dass dem Client aber nicht dem Server bekannt ist. In der Regel wird durch die Authentifizierung durch einen IDP dem Client und Server ein gemeinsames Geheimnis zur Verfügung gestellt, was aber nicht den oben beschriebenen Anforderungen genügt.
Unabhängig von der verwendeten Authentisierungsmethode kann stets ein privater Schlüssel vom Benutzer zur Verfügung gestellt werden, beispielsweise indem er eine entsprechende Datei auf seinem System ablegt und für die Webanwendung freigibt. Diese Lösung verringert aber die Benutzbarkeit der Anwendung erheblich, weil die Schlüsseldatei für die Verwendung der Anwendung notwendig ist und die vom Benutzer gewählte Authentisierungsmethode nicht mehr alleine für die Anwendung ausreicht. Tatsächlich wäre eine anderweitige Authentisierung in diesem Fall hinfällig, weil der geheime private Schlüssel auch zur Durchführung einer Authentisierung eingesetzt werden könnte.
Es lässt sich also zusammenfassen, sich das Verfahren für beliebige Authentisierungsmethoden umsetzen lässt, aber abhängig von dieser Methode Mehraufwand für den Benutzer bedeuten würde. Insbesondere wird der Einsatz eines IDP, der das Verfahren nicht unterstützt, de facto nutzlos. Um einen solchen IDP einsetzen zu können, müsste entweder der private Schlüssel vom Benutzer zusätzlich bereitgestellt werden oder die Datenverschlüsselung für solche Profile deaktiviert werden. Beide Optionen sind für einen Einsatz in der Praxis nicht tauglich. Ersteres könnte vom Benutzer für eine Mehrfaktorauthentifizierung gehalten werden, und würde auch den Aufwand einer Mehrfaktorauthentifizierung für den Benutzer mit sich bringen, wäre aber schwächer als eine echte Mehrfaktorauthentifizierung, weil für die Dateiverschlüsselung nur einer der Faktoren relevant ist. Die zweite Option, die Verschlüsselung für diese Profile zu deaktivieren, würde alle Vorteile zunichte machen, die der Einsatz des beschriebenen aufwendigen Dateiverschlüsselungsverfahren bringt. Das gelte zwar nur für Benutzer, die die betroffene Authentisierungsmethode verwenden, würde aber dazu führen, dass die Sicherheitsgarantien, die das System liefert, nicht intuitiv verständlich sind. Keine der beiden vorgenannten Lösungsansätze ist also praxistauglich. Gleichwohl kann einer dieser Ansätze in einem Beispielprojekt Anwendung finden, das sowohl die Einbindung eines externen IDP als auch die Verwendung kryptografischer Verfahren demonstrieren soll.
Es ist außerdem zu berücksichtigen, dass privilegierte Benutzer auch eine Manipulation an der Webanwendung vornehmen können. Eine solche Manipulation könnte zur Offenlegung von kryptografischen Schlüsseln oder von Nutzdaten führen. Dieses Problem entspringt der Tatsache, dass die Logik der Webanwendung als Teil der Webseite mit ausgeliefert wird und der Benutzer diese nicht überprüft. Um dieses Problem zu lösen, wäre eine Integritätssicherung für die Webanwendung erforderlich. Diese müsste aber durch das HTTP selbst und nicht durch die Webanwendung implementiert werden, weil jeder in der Webanwendung integrierte Integritätsschutz selbst anfällig für eine Manipulation durch entsprechend privilegierte Benutzer wäre. Da ein entsprechender Mechanismus aber derzeit nicht existiert, ist dieses Problem im Kern nicht lösbar.
Ein zweiter Angriff, der durch entsprechend privilegierte Benutzer ausgeführt werden kann, ist die Übermittlung gefälschter öffentlicher Schlüssel für Freigabeziele. Vertraut der Benutzer einem solchen gefälschten öffentlichen Schlüssel und gibt die Datei über diesen Schlüssel frei, erhält der Besitzer des privaten Schlüssels Zugriff auf die Datei. Dieses Problem kann vermieden werden, indem der Benutzer beim erstmaligen Hinzufügen eines Arztes den entsprechenden öffentlichen Schlüssel überprüft. Bei der Wiederverwendung kann auf eine erneute manuelle Prüfung verzichtet werden, indem der Benutzer eine mit seinem privaten Schlüssel signierte Liste an vertrauenswürdigen öffentlichen Schlüsseln führt, die dann auch durch die zentrale Anwendung verwaltet werden kann. Allerdings muss sichergestellt sein, dass Einträge aus dieser Liste auch zuverlässig entfernt werden können.
Bei der Verwendung des beschriebenen Verfahrens ist zu berücksichtigen, dass je nachdem, wie der private Schlüssel des Benutzers geschützt wird, der Zugriff auf die Daten verloren gehen kann, wenn der Benutzer bestimmte Authentisierungsmerkmale verliert. Vergisst der Benutzer beispielsweise ein Passwort, aus dem ein Geheimnis zur Verschlüsslung des privaten Schlüssels abgeleitet ist, so kann zwar sein Passwort für den Zugriff auf die Anwendung zurückgesetzt werden, der Zugriff auf die Daten geht aber verloren. Dieses Problem kann reduziert werden, indem der Benutzer bei der erstmaligen Registrierung aufgefordert wird, eine Wiederherstellungsdatei abzulegen. Außerdem ist zu berücksichtigen, dass das Entziehen einer einmal erteilten Freigabe nur eingeschränkt möglich ist, weil derjenige, dem eine Datei zugänglich gemacht wurde, stets eine Kopie dieser Datei speichern kann.
Zuletzt ist anzumerken, dass das beschriebene Verfahren notwendigerweise und erwünschterweise dazu führt, dass die Webanwendung relevante kryptografische Schlüssel verwaltet und diese daher verwundbar für die Offenlegung durch entsprechende webbasierte Angriffe sind. Wird ein solcher Schlüssel kompromittiert, geht der Schutz vor bestimmten Angriffen durch privilegierte Benutzer beziehungsweise Angreifer, die vollständigen Systemzugriff auf die Anwendung erlange haben, verloren. Der eingangs beschriebene Schutz der Kommunikationswege bleibt jedoch trotzdem bestehen.
